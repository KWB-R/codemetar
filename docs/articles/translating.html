<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Translating between schema using JSON-LD • codemetar</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">codemetar</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="..//index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/codemeta-intro.html">Codemeta intro</a>
    </li>
    <li>
      <a href="../articles/codemeta-parsing.html">Parsing CodeMeta Data</a>
    </li>
    <li>
      <a href="../articles/translating.html">Translating between schema using JSON-LD</a>
    </li>
    <li>
      <a href="../articles/validation-in-json-ld.html">Validation in JSON-LD</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/codemeta/codemetar">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Translating between schema using JSON-LD</h1>
                        <h4 class="author">Carl Boettiger</h4>
            
            <h4 class="date">2017-07-11</h4>
          </div>

    
    
<div class="contents">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">"codemetar"</span>)
<span class="kw">library</span>(<span class="st">"magrittr"</span>)
<span class="kw">library</span>(<span class="st">"jsonlite"</span>)
<span class="kw">library</span>(<span class="st">"jsonld"</span>)
<span class="kw">library</span>(<span class="st">"httr"</span>)
<span class="kw">library</span>(<span class="st">"readr"</span>)</code></pre></div>
<div id="json-ld-transforms-expansion-and-compaction" class="section level2">
<h2 class="hasAnchor">
<a href="#json-ld-transforms-expansion-and-compaction" class="anchor"></a>JSON-LD transforms: Expansion and Compaction</h2>
<p>One of the central motivations of JSON-LD is making it easy to translate between different representations of what are fundamentally the same data types. Doing so uses the two core algorithms of JSON-LD: <em>expansion</em> and <em>compaction</em>, as <a href="https://www.youtube.com/watch?v=Tm3fD89dqRE">this excellent short video by JSON-LD creator Manu Sporny</a> describes.</p>
<p>Here’s how we would use JSON-LD (from R) to translate between the two examples of JSON data from different providers as shown in the video. First, the JSON from the original provider:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ex &lt;-
<span class="st">'{</span>
<span class="st">"@context":{</span>
<span class="st">  "shouter": "http://schema.org/name",</span>
<span class="st">  "txt": "http://schema.org/commentText"</span>
<span class="st">},</span>
<span class="st">"shouter": "Jim",</span>
<span class="st">"txt": "Hello World!"</span>
<span class="st">}'</span></code></pre></div>
<p>Next, we need the context of the second data provider. This will let us translate the JSON format used by provider one (“Shouttr”) to the second (“BigHash”):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">bighash_context &lt;-<span class="st"> </span>
<span class="st">'{</span>
<span class="st">"@context":{</span>
<span class="st">  "user": "http://schema.org/name",</span>
<span class="st">  "comment": "http://schema.org/commentText"</span>
<span class="st">}</span>
<span class="st">}'</span></code></pre></div>
<p>With this in place, we simply expand the original JSON and then compact using the new context:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="http://www.rdocumentation.org/packages/jsonld/topics/jsonld">jsonld_expand</a></span>(ex) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/jsonld/topics/jsonld">jsonld_compact</a></span>(<span class="dt">context =</span> bighash_context)</code></pre></div>
<pre><code>{
  "@context": {
    "user": "http://schema.org/name",
    "comment": "http://schema.org/commentText"
  },
  "comment": "Hello World!",
  "user": "Jim"
} </code></pre>
</div>
<div id="crosswalking" class="section level2">
<h2 class="hasAnchor">
<a href="#crosswalking" class="anchor"></a>Crosswalking</h2>
<p>The CodeMeta Crosswalk table seeks to accomplish a very similar goal. The crosswalk table provides a human-readable mapping of different software metadata providers into the codemeta context (an extension of schema.org). For instance, we’ll read in some data from GitHub:</p>
<div id="github" class="section level3">
<h3 class="hasAnchor">
<a href="#github" class="anchor"></a>GitHub</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">r &lt;-<span class="st"> </span>gh<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/gh/topics/gh">gh</a></span>(<span class="st">"/repos/:owner/:repo"</span>, <span class="dt">owner =</span> <span class="st">"ropensci"</span>, <span class="dt">repo =</span> <span class="st">"EML"</span>)
github_meta &lt;-<span class="st"> </span><span class="kw"><a href="../reference/crosswalk.html">crosswalk</a></span>(r, <span class="st">"GitHub"</span>)
github_meta</code></pre></div>
<pre><code>{
  "@context": "https://doi.org/10.5063/schema/codemeta-2.0",
  "codeRepository": "https://github.com/ropensci/EML",
  "dateCreated": "2013-06-23T23:20:03Z",
  "dateModified": "2017-05-11T21:24:40Z",
  "description": " Ecological Metadata Language interface for R: synthesis and integration of heterogenous data",
  "downloadUrl": "https://api.github.com/repos/ropensci/EML/{archive_format}{/ref}",
  "identifier": "10894022",
  "name": "ropensci/EML",
  "programmingLanguage": "https://api.github.com/repos/ropensci/EML/languages",
  "issueTracker": "https://api.github.com/repos/ropensci/EML/issues{/number}"
} </code></pre>
</div>
</div>
<div id="transforming-into-other-column-schema" class="section level2">
<h2 class="hasAnchor">
<a href="#transforming-into-other-column-schema" class="anchor"></a>Transforming into other column schema</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/crosswalk.html">crosswalk</a></span>(r, <span class="st">"Zenodo"</span>, <span class="st">"GitHub"</span>) <span class="op">%&gt;%</span>
<span class="kw"><a href="../reference/drop_context.html">drop_context</a></span>()</code></pre></div>
<pre><code>{
  "id": "10894022",
  "full_name": "EML"
} </code></pre>
</div>
<div id="datacite" class="section level2">
<h2 class="hasAnchor">
<a href="#datacite" class="anchor"></a>DataCite</h2>
<p>We can illustrate using the expansion and compaction process to crosswalk DataCite’s metadata schema into other formats, such as the native codemeta format or the Zenodo format. First, let’s start with some DataCite metadata:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">datacite_ex &lt;-<span class="st"> "https://raw.githubusercontent.com/codemeta/codemetar/master/inst/examples/datacite-xml.json"</span>
<span class="kw">cat</span>(<span class="kw">readLines</span>(datacite_ex), <span class="dt">sep=</span><span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</code></pre></div>
<pre><code>{
  "identifier": "10.5281/zenodo.573741",
  "creators": [
    { "givenName": "Jouni",
      "familyName": "Helske"
    },
    {
      "givenName": "Matti",
      "familyName": "Vihola"
    }
  ],
  "title": "Bayesian Inference Of State Space Models With The Bssm Package",
  "publisher": "Zenodo",
  "publicationYear": "2017",
  "resourceType": "Software",
  "date": "2017-05-10",
  "rights": "Open Access",
  "description": [
      "Efficient methods for Bayesian inference of state space models via particle Markov chain Monte Carlo and importance sampling type corrected Markov chain Monte Carlo. Currently supports models with Gaussian, Poisson, binomial, or negative binomial observation densities and Gaussian state dynamics, as well as general non-linear Gaussian models.",
      "Funded by Academy of Finland grant 284513, \"Exact approximate Monte Carlo methods for complex Bayesian inference\"."
  ]
}</code></pre>
<p>Note this example uses a JSON-ified representation of DataCite’s internal schema, which is XML-based. So far, this is just plain JSON, with no context. We will use the <code><a href="http://www.rdocumentation.org/packages/codemetar/topics/crosswalk">codemetar::crosswalk</a></code> function to translate this into codemeta representation. This function simply creates a context file for the input data, based on the crosswalk table, and then performs the JSON-LD Expansion algorithm followed by the JSON-LD Compaction algorithm into the codemeta context, in just the same manner as illustrated above.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">datacite_meta &lt;-<span class="st"> </span>jsonlite<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/jsonlite/topics/read_json">read_json</a></span>(datacite_ex)
dc &lt;-<span class="st"> </span><span class="kw"><a href="../reference/crosswalk.html">crosswalk</a></span>(datacite_meta,<span class="st">"DataCite"</span>)
dc</code></pre></div>
<pre><code>{
  "@context": "https://doi.org/10.5063/schema/codemeta-2.0",
  "author": [
    {
      "familyName": "Helske",
      "givenName": "Jouni"
    },
    {
      "familyName": "Vihola",
      "givenName": "Matti"
    }
  ],
  "dateModified": "2017-05-10",
  "datePublished": "2017",
  "description": [
    "Efficient methods for Bayesian inference of state space models via particle Markov chain Monte Carlo and importance sampling type corrected Markov chain Monte Carlo. Currently supports models with Gaussian, Poisson, binomial, or negative binomial observation densities and Gaussian state dynamics, as well as general non-linear Gaussian models.",
    "Funded by Academy of Finland grant 284513, \"Exact approximate Monte Carlo methods for complex Bayesian inference\"."
  ],
  "identifier": "10.5281/zenodo.573741",
  "license": "Open Access",
  "publisher": "Zenodo"
} </code></pre>
<div id="comparison-to-native-schema-org-translation" class="section level3">
<h3 class="hasAnchor">
<a href="#comparison-to-native-schema-org-translation" class="anchor"></a>Comparison to native schema.org translation:</h3>
<p>DataCite actually returns data directly in JSON-LD format using exclusively the schema.org context. We can query that data directly:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">resp &lt;-<span class="st"> </span>httr<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/httr/topics/GET">GET</a></span>(<span class="st">"https://doi.org/10.5281/zenodo.573741"</span>, httr<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/httr/topics/add_headers">add_headers</a></span>(<span class="dt">Accept=</span><span class="st">"application/vnd.schemaorg.ld+json"</span>))
datacite_jsonld &lt;-<span class="st"> </span>httr<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/httr/topics/content">content</a></span>(resp, <span class="dt">type=</span><span class="st">"application/json"</span>)</code></pre></div>
<p>This time we have no need to invoke the crosswalk context, since the data is already in schema.org context (which codemeta also uses):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">datacite_cm &lt;-<span class="st"> </span>
<span class="st">  </span>datacite_jsonld <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/jsonlite/topics/fromJSON">toJSON</a></span>(<span class="dt">pretty =</span> <span class="ot">TRUE</span>, <span class="dt">auto_unbox =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/jsonld/topics/jsonld">jsonld_expand</a></span>() <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/jsonld/topics/jsonld">jsonld_compact</a></span>(<span class="dt">context =</span> <span class="st">"https://raw.githubusercontent.com/codemeta/codemeta/master/codemeta.jsonld"</span>) 
datacite_cm</code></pre></div>
<pre><code>{
  "@context": "https://raw.githubusercontent.com/codemeta/codemeta/master/codemeta.jsonld",
  "id": "https://doi.org/10.5281/zenodo.573741",
  "type": "SoftwareSourceCode",
  "schema:additionalType": {
    "id": "Software"
  },
  "schema:author": [
    {
      "type": "Person",
      "familyName": "Helske",
      "givenName": "Jouni",
      "name": "Jouni Helske"
    },
    {
      "type": "Person",
      "familyName": "Vihola",
      "givenName": "Matti",
      "name": "Matti Vihola"
    }
  ],
  "datePublished": "2017-05-10",
  "description": "Efficient methods for Bayesian inference of state space models via particle Markov chain Monte Carlo and importance sampling type corrected Markov chain Monte Carlo. Currently supports models with Gaussian, Poisson, binomial, or negative binomial observation densities and Gaussian state dynamics, as well as general non-linear Gaussian models.",
  "name": "Bayesian Inference Of State Space Models With The Bssm Package",
  "provider": {
    "type": "Organization",
    "name": "DataCite"
  },
  "publisher": {
    "type": "Organization",
    "name": "Zenodo"
  },
  "schema:schemaVersion": {
    "id": "http://datacite.org/schema/kernel-3"
  }
} </code></pre>
<p>This is very close to the codemeta document we got by translating the DataCite XML using the crosswalk table.</p>
</div>
<div id="translating-between-arbitrary-columns-in-the-crosswalk" class="section level3">
<h3 class="hasAnchor">
<a href="#translating-between-arbitrary-columns-in-the-crosswalk" class="anchor"></a>Translating between arbitrary columns in the crosswalk</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/crosswalk.html">crosswalk</a></span>(datacite_meta, <span class="st">"DataCite"</span>, <span class="st">"Zenodo"</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="kw"><a href="../reference/drop_context.html">drop_context</a></span>() <span class="co"># show only content</span></code></pre></div>
<pre><code>{
  "creators": [
    {
      "schema:familyName": "Helske",
      "schema:givenName": "Jouni"
    },
    {
      "schema:familyName": "Vihola",
      "schema:givenName": "Matti"
    }
  ],
  "schema:dateModified": {
    "@type": "schema:Date",
    "@value": "2017-05-10"
  },
  "date_published": "2017",
  "description/notes": ["Efficient methods for Bayesian inference of state space models via particle Markov chain Monte Carlo and importance sampling type corrected Markov chain Monte Carlo. Currently supports models with Gaussian, Poisson, binomial, or negative binomial observation densities and Gaussian state dynamics, as well as general non-linear Gaussian models.", "Funded by Academy of Finland grant 284513, \"Exact approximate Monte Carlo methods for complex Bayesian inference\"."],
  "id": "10.5281/zenodo.573741",
  "license": "Open Access",
  "schema:publisher": "Zenodo"
} </code></pre>
<p>This data should be now use valid Zenodo terms (e.g. using <code>creators</code> for <code>schema:author</code>). Note that we also see explicitly the context that <code>codemeta::crosswalk</code> produced as <code>zenodo_context</code>, since we passed this information as a json file and not a URL. This provides a nice illustration of what the crosswalk is returning when asked for a context of a given column.</p>
<p>Note that data that many of the fields could not be directly crosswalked into Zenodo terms, because (at least according to the crosswalk table) they have no analog in Zenodo, such as <code>schema:dateCreated</code>. Instead of dropping this data, the JSON-LD has retained the information using the original prefix <code>schema:</code>, indicating that the term is part of the <code>schema.org</code> context but not recognized in the context of Zenodo.</p>
<p>Note this also happens if properties do not have a 1:1 map, since JSON-LD doesn’t provide a convenient way to map two separate properties like <code>givenName</code>, <code>familyName</code> into a single property, <code>name</code> either. JSON-LD will also refuse to map a term that has a potentially different type in the new context (since type coercion can also lead to data loss). In this way, compaction is very conservative.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#json-ld-transforms-expansion-and-compaction">JSON-LD transforms: Expansion and Compaction</a></li>
      <li><a href="#crosswalking">Crosswalking</a></li>
      <li><a href="#transforming-into-other-column-schema">Transforming into other column schema</a></li>
      <li><a href="#datacite">DataCite</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Carl Boettiger.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
